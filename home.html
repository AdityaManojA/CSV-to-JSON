<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro CSV Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --matrix-green: #39ff14;
            --bg-dark: #1a1a2e;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: var(--bg-dark);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- RETRO BACKGROUND EFFECTS --- */
        
        /* The moving grid floor */
        .retro-grid {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%; /* Lower half only */
            background-image: 
                linear-gradient(transparent 95%, var(--neon-pink) 95%),
                linear-gradient(90deg, transparent 95%, var(--neon-blue) 95%);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg) scale(2) translateY(100px);
            opacity: 0.4;
            animation: gridMove 2s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 40px; }
        }

        /* CRT Scanline Overlay */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
            opacity: 0.6;
        }

        /* --- COMPONENT STYLING --- */

        .retro-card {
            background: rgba(16, 16, 26, 0.85);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue), inset 0 0 20px rgba(5, 217, 232, 0.1);
            backdrop-filter: blur(5px);
        }

        .retro-input {
            background-color: #000;
            color: var(--matrix-green);
            border: 1px solid #333;
            font-size: 1.2rem;
            box-shadow: inset 0 0 10px rgba(57, 255, 20, 0.2);
        }
        
        .retro-input:focus {
            outline: none;
            border-color: var(--matrix-green);
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.4), inset 0 0 10px rgba(57, 255, 20, 0.2);
        }

        /* Radio Buttons */
        .custom-radio {
            appearance: none;
            background-color: #000;
            border: 2px solid var(--neon-pink);
            width: 1.2rem;
            height: 1.2rem;
            display: inline-block;
            position: relative;
            cursor: pointer;
        }
        .custom-radio:checked {
            background-color: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }

        /* Buttons */
        .btn-retro {
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.4rem;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-retro:active {
            transform: translateY(2px);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #000; 
        }
        ::-webkit-scrollbar-thumb {
            background: var(--neon-pink); 
            border: 2px solid #000;
        }

        .neon-text-shadow {
            text-shadow: 2px 2px 0px #ff2a6d;
        }
        
        .notification {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            border: 2px solid var(--matrix-green);
            background: #000;
            color: var(--matrix-green);
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 0 15px var(--matrix-green);
        }
        .notification.show {
            opacity: 1;
            transform: translate(-50%, -10px);
        }
    </style>
</head>
<body class="selection:bg-pink-500 selection:text-white">

    <div class="retro-grid"></div>
    <div class="scanlines"></div>

    <div class="container mx-auto px-4 py-8 relative z-10">
        <header class="text-center mb-10">
            <h1 class="text-6xl md:text-7xl font-bold text-white neon-text-shadow tracking-widest">CSV_TO_JSON</h1>
            <p class="text-2xl text-cyan-300 mt-2 opacity-80 tracking-wide">>> SYSTEM.INITIALIZE_CONVERTER_TOOL_V1.0</p>
        </header>

        <div class="retro-card p-6 rounded-none mb-8 grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <div>
                <h3 class="text-2xl text-pink-500 mb-4 border-b-2 border-pink-500 inline-block w-full">>> SELECT_DELIMITER</h3>
                <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-xl">
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="delimiter" class="custom-radio" value="," checked>
                        <span>Comma (,)</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="delimiter" class="custom-radio" value=";">
                        <span>Semicolon (;)</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="delimiter" class="custom-radio" value="\t">
                        <span>Tab</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="delimiter" class="custom-radio" value="custom">
                        <span>Custom:</span>
                    </label>
                    <input type="text" id="customDelimiterInput" class="bg-black border border-pink-500 text-pink-500 px-2 py-1 w-16 focus:ring-2 focus:ring-pink-500 outline-none">
                </div>
            </div>
            
            <div>
                <h3 class="text-2xl text-pink-500 mb-4 border-b-2 border-pink-500 inline-block w-full">>> JSON_FORMATTING</h3>
                <div class="flex items-center space-x-6 text-xl">
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="spacing" class="custom-radio" value="4" checked>
                        <span>4 Spaces</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="spacing" class="custom-radio" value="2">
                        <span>2 Spaces</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:text-cyan-300 transition-colors">
                        <input type="radio" name="spacing" class="custom-radio" value="0">
                        <span>Minified</span>
                    </label>
                </div>
            </div>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <div class="flex flex-col retro-card p-1 rounded-none relative group">
                <div class="bg-pink-600 text-black font-bold px-4 py-1 text-xl absolute -top-4 left-4 border border-pink-600">INPUT.CSV</div>
                <textarea id="csvInput" class="retro-input w-full h-96 p-4 mt-4 resize-none" placeholder="header1,header2,header3&#10;value1,value2,value3"></textarea>
            </div>

            <div class="flex flex-col retro-card p-1 rounded-none relative">
                <div class="bg-cyan-400 text-black font-bold px-4 py-1 text-xl absolute -top-4 left-4 border border-cyan-400">OUTPUT.JSON</div>
                <textarea id="jsonOutput" readonly class="retro-input w-full h-96 p-4 mt-4 resize-none text-yellow-300" placeholder="// JSON data will render here..."></textarea>
            </div>
        </main>
        
        <div class="flex flex-wrap justify-center items-center gap-6 mt-12">
            <button id="convertBtn" class="btn-retro px-8 py-3 bg-pink-600 text-white border-2 border-pink-600 hover:bg-black hover:text-pink-600 hover:shadow-[0_0_20px_#ff2a6d]">
                [ EXECUTE_CONVERSION ]
            </button>
            <button id="copyBtn" class="btn-retro px-8 py-3 bg-cyan-600 text-white border-2 border-cyan-600 hover:bg-black hover:text-cyan-400 hover:shadow-[0_0_20px_#05d9e8]">
                [ COPY_DATA ]
            </button>
            <button id="clearBtn" class="btn-retro px-8 py-3 bg-red-600 text-white border-2 border-red-600 hover:bg-black hover:text-red-500 hover:shadow-[0_0_20px_#ef4444]">
                [ CLEAR_MEMORY ]
            </button>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        const csvInput = document.getElementById('csvInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const convertBtn = document.getElementById('convertBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        const notification = document.getElementById('notification');
        const customDelimiterInput = document.getElementById('customDelimiterInput');

        function getSelectedDelimiter() {
            const selected = document.querySelector('input[name="delimiter"]:checked').value;
            if (selected === 'custom') {
                return customDelimiterInput.value || ',';
            }
            if (selected === '\\t') {
                return '\t';
            }
            return selected;
        }

        function getSelectedSpacing() {
            const spacing = document.querySelector('input[name="spacing"]:checked').value;
            return parseInt(spacing, 10) || 0; // Default to 0 if NaN (for Minified)
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
        }

        convertBtn.addEventListener('click', () => {
            const csvText = csvInput.value.trim();
            if (!csvText) {
                showNotification('ERROR: INPUT_EMPTY', 'border-red-500 text-red-500 shadow-red-500');
                jsonOutput.value = '';
                return;
            }

            try {
                const delimiter = getSelectedDelimiter();
                const spacing = getSelectedSpacing();

                const lines = csvText.split(/\r?\n/);
                const filteredLines = lines.filter(line => line.trim() !== '');
                if (filteredLines.length < 2) {
                    throw new Error('REQUIRE: HEADER + DATA ROW');
                }
                
                const headers = filteredLines[0].split(delimiter).map(header => header.trim());
                const result = [];

                const escapedDelimiter = escapeRegExp(delimiter);
                // Regex to handle quoted values containing delimiters
                const regex = new RegExp(`(".*?"|[^"${escapedDelimiter}]+)(?=\\s*${escapedDelimiter}|\\s*$)`, 'g');

                for (let i = 1; i < filteredLines.length; i++) {
                    const obj = {};
                    // If delimiter is not found in line, simple split might fail logic for single column, but regex is safer
                    // Fallback for simple split if regex returns null (e.g. empty lines handled above)
                    let values = filteredLines[i].match(regex);
                    
                    // Edge case: formatting fix if match fails on strict patterns
                    if (!values) values = filteredLines[i].split(delimiter);

                    const cleanedValues = values.map(value => {
                        return value.trim().replace(/^"|"$/g, '').trim();
                    });

                    if (cleanedValues.length !== headers.length) {
                         console.warn(`Row ${i+1} mismatch. Skipping.`);
                         continue;
                    }

                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j]] = cleanedValues[j];
                    }
                    result.push(obj);
                }

                jsonOutput.value = JSON.stringify(result, null, spacing);
                showNotification('SUCCESS: CONVERSION_COMPLETE', 'border-green-500 text-green-500 shadow-green-500');
            } catch (error) {
                jsonOutput.value = `ERROR: ${error.message}`;
                showNotification('SYSTEM_FAILURE', 'border-red-500 text-red-500 shadow-red-500');
            }
        });

        copyBtn.addEventListener('click', () => {
            const jsonText = jsonOutput.value;
            if (!jsonText || jsonText.startsWith('ERROR:')) {
                showNotification('ERROR: BUFFER_EMPTY', 'border-yellow-500 text-yellow-500 shadow-yellow-500');
                return;
            }
            
            navigator.clipboard.writeText(jsonText).then(() => {
                showNotification('SUCCESS: COPIED_TO_CLIPBOARD', 'border-cyan-500 text-cyan-500 shadow-cyan-500');
            }).catch(err => {
                showNotification('ERROR: COPY_FAILED', 'border-red-500 text-red-500 shadow-red-500');
            });
        });
        
        clearBtn.addEventListener('click', () => {
           csvInput.value = '';
           jsonOutput.value = '';
           showNotification('MEMORY_CLEARED', 'border-gray-500 text-gray-500 shadow-gray-500');
        });

        function showNotification(message, styleClasses) {
            notification.textContent = `>> ${message}`;
            // Reset classes
            notification.className = 'notification';
            if(styleClasses) {
                const classes = styleClasses.split(' ');
                notification.classList.add(...classes);
            }
            
            // Trigger reflow
            void notification.offsetWidth;
            
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>